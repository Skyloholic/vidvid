<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Video Downloader</title>

<style>
body {
    background: linear-gradient(135deg,#667eea,#764ba2);
    font-family: Arial;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
.box {
    background: white;
    padding: 35px;
    border-radius: 15px;
    width: 420px;
}
input, select, button {
    width: 100%;
    padding: 12px;
    margin-top: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
}
button {
    background: #667eea;
    color: white;
    font-weight: bold;
    border: none;
    cursor: pointer;
}
button:disabled {
    opacity: 0.6;
}
#msg {
    margin-top: 15px;
    font-size: 14px;
}
</style>
</head>

<body>
<div class="box">
    <h2>ðŸŽ¥ Video Downloader</h2>

    <input id="url" placeholder="Paste video URL">

    <select id="quality">
        <option value="best">Best (Auto)</option>
        <option value="1080">1080p</option>
        <option value="720">720p</option>
        <option value="480">480p</option>
        <option value="360">360p</option>
    </select>

    <button id="btn">Download</button>
    <button id="bat-btn" style="margin-top:8px;background:#764ba2;">Download with yt-dlp (.bat)</button>
    <div id="msg"></div>
</div>

<script>
const btn = document.getElementById('btn');
const msg = document.getElementById('msg');
const batBtn = document.getElementById('bat-btn');

btn.onclick = async () => {
    const url = document.getElementById('url').value;
    const quality = document.getElementById('quality').value;

    if (!url.startsWith('http')) {
        msg.textContent = "Invalid URL";
        return;
    }

    btn.disabled = true;
    msg.textContent = "Downloading...";

    try {
        const res = await fetch('/download', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ url, quality })
        });

        if (!res.ok) {
            const err = await res.json();
            throw new Error(err.message);
        }

        const cd = res.headers.get('content-disposition');
        let filename = 'video.mp4';
        if (cd) {
            const m = cd.match(/filename="?(.+)"?/);
            if (m) filename = m[1];
        }

        const blob = await res.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = filename;
        a.click();

        msg.textContent = "Download started âœ”";
    } catch (e) {
        msg.textContent = "Error: " + e.message;
    } finally {
        btn.disabled = false;
    }
};

batBtn.onclick = () => {
    const url = document.getElementById('url').value.trim();
    if (!url.startsWith('http')) {
        msg.textContent = "Invalid URL for .bat";
        return;
    }
    // Download .bat file with video URL as argument
    const batUrl = `/bat?url=${encodeURIComponent(url)}`;
    const a = document.createElement('a');
    a.href = batUrl;
    a.download = 'download.bat';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    msg.textContent = ".bat file downloaded. Double-click to start yt-dlp.";
};
</script>
</body>
</html>
